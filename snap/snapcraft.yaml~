name: rjd-sra-tools
title: rjd-sra-tools
version: '313b45f' # just for humans, typically '1.2+git' or '1.3.2'
summary: Toolkit from NCBI for using Sequence Read Archives data.
description: |
          " The SRA Toolkit and SDK from NCBI is a collection of tools and libraries for using data in the INSDC Sequence Read Archives.."
          *  The description above refers to the software:
          * I have packaged the software as a snap for **personal use** but I have made the snap available for free.
          * I do not maintain the software itself. I only maintain the snap packaging. Please report software bugs to the maintainers.
          * Report snap-specific bugs to me.
            * I _DO_ use this snap. It _has been superficially tested_ on my system. I __do not__ track the latest version.
            * __The snap has not been fully tested__
            * Packaging 'style' : git build for linux machines.
            * License refers to the original software, not the snapcraft 'code'.
            * More info:
            * Run the following to rename the snap
            ```sudo snap alias rjd-sra-tools.sra-tools sra-tools```

website: https://github.com/RJDan/rjd-sra-tools_snap
source-code : https://github.com/RJDan/rjd-sra-tools_snap
icon: Icon_230417.svg

grade: stable # must be 'stable' to release into candidate/stable channels
confinement: strict # use 'strict' once you have the right plugs and slots
license: GPL-3.0-only
base: core22 # the base snap is the execution environment for this snap

apps:
    sra-tools:
        command: /usr/local/bin/sra-tools
        plugs:
          - home
          - network
          - removable-media
        environment:
            # XDG config
            # XDG_CACHE_HOME:  $SNAP_USER_COMMON/.cache
            # XDG_CONFIG_HOME: $SNAP_USER_DATA/.config
#            LD_LIBRARY_PATH: $LD_LIBRARY_PATH:$SNAP/usr/lib/$SNAPCRAFT_ARCH_TRIPLET/lapack:$SNAP/usr/lib/$SNAPCRAFT_ARCH_TRIPLET/blas
            JAVA_HOME: $SNAP/usr/lib/jvm/java-17-openjdk-${SNAPCRAFT_TARGET_ARCH}
            JAVA_TOOL_OPTIONS: "-Duser.home=$SNAP_USER_COMMON"
            PATH: $JAVA_HOME/bin:$JAVA_HOME/jre/bin:$PATH
#            VDB_BINDIR: ${STAGE}/ # where the output should be available during the build
            VDB_BINDIR: ${SNAP}/usr/local/include/ # where I found the binaries
#            VDB_INCDIR: ${SNAP}/parts/sra-tools/src/../ncbi-vdb/interfaces
            VDB_INCDIR: ${SNAP}/usr/local/include/
            VDB_LIBDIR: ${STAGE}/usr/local/include/  #this looks like the place where vdb libs were placed
#            NCBI_VDB_LIBDIR:   # must point to installed libraries
#Please specify the location of an ncbi-vdb build in Cmake variable VDB_BINDIR. It is expected to contain one or both subdirectories Debug/ and Release/, with bin/, lib/ and ilib/ underneath each.

CMakeLists.txt:set( VDB_BINDIR "${CMAKE_BINARY_DIR}/../ncbi-vdb" CACHE PATH "Location of NCBI VDB build directory" )
CMakeLists.txt:set( VDB_INCDIR "${CMAKE_SOURCE_DIR}/../ncbi-vdb/interfaces" CACHE PATH "Location of NCBI VDB include directory" )

build/env.cmake:    set( NCBI_VDB_BINDIR_DEBUG ${VDB_BINDIR}/Debug/bin )
build/env.cmake:    set( NCBI_VDB_BINDIR_RELEASE ${VDB_BINDIR}/Release/bin )
build/env.cmake:    set( NCBI_VDB_LIBDIR_DEBUG ${VDB_BINDIR}/Debug/lib )
build/env.cmake:    set( NCBI_VDB_LIBDIR_RELEASE ${VDB_BINDIR}/Release/lib )
build/env.cmake:    set( NCBI_VDB_ILIBDIR_DEBUG ${VDB_BINDIR}/Debug/ilib )
build/env.cmake:    set( NCBI_VDB_ILIBDIR_RELEASE ${VDB_BINDIR}/Release/ilib )

tools2/shared/cmake/Findncbi-vdb.cmake:find_library (NCBI_VDB_LIB "ncbi-vdb" ENV NCBI_VDB_LIBDIR)
tools2/shared/cmake/Findncbi-vdb.cmake:if (NCBI_VDB_LIB MATCHES NCBI_VDB_LIB-NOTFOUND)
tools2/shared/cmake/Findncbi-vdb.cmake:    find_library (NCBI_VDB_LIB "ncbi-vdb" PATHS "/usr/local/ncbi" "$ENV{HOME}/usr/local/ncbi" "$ENV{HOME}/ncbi" NO_DEFAULT_PATH)
tools2/shared/cmake/Findncbi-vdb.cmake:if (NCBI_VDB_LIB MATCHES NCBI_VDB_LIB-NOTFOUND)
tools2/shared/cmake/Findncbi-vdb.cmake:    set (NCBI_VDB_LIB_DIR_ROOT "$ENV{HOME}/ncbi-outdir/ncbi-vdb/${NCBI_VDB_SYSTEM_NAME}/${NCBI_VDB_COMPILER_NAME}/x86_64/")
tools2/shared/cmake/Findncbi-vdb.cmake:        set (NCBI_VDB_LIB_DIRS "${NCBI_VDB_LIB_DIR_ROOT}/dbg/lib" "${NCBI_VDB_LIB_DIR_ROOT}/rel/lib")
tools2/shared/cmake/Findncbi-vdb.cmake:        set (NCBI_VDB_LIB_DIRS "${NCBI_VDB_LIB_DIR_ROOT}/rel/lib" "${NCBI_VDB_LIB_DIR_ROOT}/dbg/lib")


# The `layout` ensures that files can be found by applications where they are expected by the toolkit or application.
#    layout:
    #     # # Other, generally useful paths
    #     # /etc/fonts:
    #     #   bind: $SNAP/etc/fonts
    #     # /usr/share/fonts:
    #     #   bind: $SNAP/usr/share/fonts
    #     # /usr/share/icons:
    #     #   bind: $SNAP/usr/share/icons
    #     # /usr/lib/${SNAPCRAFT_ARCH_TRIPLET}/lapack:
    #     #   bind: $SNAP/usr/lib/${SNAPCRAFT_ARCH_TRIPLET}/lapack
    #     # /usr/lib/${SNAPCRAFT_ARCH_TRIPLET}/blas:
    #     #   bind: $SNAP/usr/lib/${SNAPCRAFT_ARCH_TRIPLET}/blas
    #     /usr/bin/python:
    #       bind: $SNAP/usr/bin/python


parts:
    ncbi-vdb:
        source:  https://github.com/ncbi/ncbi-vdb.git
        source-type: git
        source-tag: '3.0.5' # "44cdea5" #
#        source-tag: "c4aa196" # 3.0.2
        plugin: cmake
#         cmake-parameters:
# #              - -all # specify nothing to build the default toolkit user-facing parts
#               - -all # to build all the components
        build-packages:
                - libc6-dev
                - zlib1g-dev
                - less
                - tree
        stage-packages:
             - libc6 #Automatically Tuned Linear Algebra Software, documentation
#         filesets: # relative to the part install dir, so it should have been moved over by build already
#           vdbouts:
#                         - ${SNAPCRAFT_PART_BUILD}/bin
# #                          - ${SNAPCRAFT_PART_BUILD}/Release/lib
# #                          - ${SNAPCRAFT_PART_BUILD}/Release/ilib
#         stage:
#                 - $vdbouts
#         prime:
#                 - $vdbouts
    sra-tools:
        source:  https://github.com/ncbi/sra-tools.git
        source-type: git
        source-tag: '3.0.5' # "313b45f"
        after:
          - ncbi-vdb
        plugin: cmake
#        cmake-parameters:
        build-packages:
                - libc6-dev
                - zlib1g-dev
                - libxml2-dev
                - libbison-dev
                - libfl-dev
                - python3 # needed for checking the install and nothing else
                - python3-dev # needed for checking the install and nothing else
        stage-packages:
             - flex
             - bison
             - libxml2
             - libc6 #Automatically Tuned Linear Algebra Software, documentation
        organize:
            "Icon_230417.svg" : snap/Icon_230417.svg
            "bin/sra-tools" : /usr/local/bin/sra-tools
